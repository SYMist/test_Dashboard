# 유저 플로우

## 일자 별 문의 수 차트
- 관리자는 기준 기간 별 문의 수를 조회할 수 있다.
- 관리자는 기준 기간으로 '일', '주', '월', '분기', '반기', '연'을 선택할 수 있다.
- 관리자는 선택된 기준 기간에 대해 직전 기간 대비 현재 문의 수 증감을 확인할 수 있다.
- 관리자는 마우스 호버로 특정 버킷의 날짜와 문의 수를 툴팁으로 확인할 수 있다.
- 관리자는 인사이트 보기 토글 상태(전체/인사이트 데이터)에 따라 동일 차트를 조회할 수 있다.
- 전역 기간/검색 필터가 연결된 경우, 해당 필터가 차트에 반영되어 재집계된다.

## 최근 문의 표 (트렌드 하단)
- 관리자는 최신 문의 목록을 표로 조회할 수 있다.
- 관리자는 검색창으로 상품명/상품 코드/문의 내용으로 필터링할 수 있다.
- 관리자는 정렬 옵션(최신순/오래된순)으로 정렬할 수 있다.
- 관리자는 페이지네이션을 통해 목록을 넘겨볼 수 있다(10행/페이지).
- 관리자는 '요청 ID'를 클릭하면 해당 문의의 젠데스크 문의 상세 페이지로 이동할 수 있다.
- 관리자는 '예약코드'를 클릭하면 해당 예약의 어드민 예약 상세 페이지로 이동할 수 있다.

## 대카테고리별 세부 카테고리 파이차트 (여행/쇼핑/어학당)
- 관리자는 대카테고리(여행/쇼핑/어학당)별 세부 카테고리 분포를 파이차트로 확인할 수 있다.
- 관리자는 파이의 특정 세부 카테고리(조각 또는 범례)를 클릭해 하단 상품 차트에 교차 필터를 적용할 수 있다.
- 관리자는 상단 배지(대카테고리/세부 카테고리)를 통해 현재 활성화된 필터를 확인하고, X 버튼으로 해제할 수 있다.
- 관리자는 인사이트 보기 토글 상태(전체/인사이트 데이터)에 따라 동일 파이 분포를 조회할 수 있다.

## 상품 기반 분석 차트 (막대: 상품명 Y축, 건수 X축)
- 관리자는 차원 전환 탭으로 '문의 유형' 또는 '언어' 기준의 스택 막대를 선택할 수 있다.
- 관리자는 '문의 유형' 모드에서 언어 필터 탭(영어/일본어/대만어/홍콩어)으로 해당 언어만 보이게 할 수 있다.
- 관리자는 '언어' 모드에서 문의 유형 필터 탭으로 해당 유형만 보이게 할 수 있다.
- 관리자는 정렬 옵션(문의 많은 순/적은 순)으로 상품 순서를 조정할 수 있다.
- 관리자는 '주문량 보기' 토글로 주문 보조막대를 표시할 수 있다.
  - 언어 모드: 언어 분포 비율로 분해된 주문 스택을 확인할 수 있다.
  - 문의 유형 모드: 회색 단일 주문 보조막대를 확인할 수 있다.
- 관리자는 상품명 라벨을 클릭해 상품 툴팁(오버레이)을 열 수 있다.
  - 관리자는 툴팁 내에서 단위 탭(일/주/월/분기/반기/연) 전환과 문의/주문 시계열(그룹형 막대)을 확인할 수 있다.
  - 관리자는 툴팁 외부 클릭으로 툴팁을 닫을 수 있다.
- 관리자는 막대의 스택 세그먼트를 클릭해 세부 분포(파이)와 샘플 텍스트 리스트를 확인할 수 있다.
- 관리자는 파이차트 클릭으로 설정된 대/세부 카테고리 교차 필터와 내부 언어/유형 필터를 조합하여 결과를 좁힐 수 있다.
- 관리자는 인사이트 보기 토글 상태(전체/인사이트 데이터)에 따라 동일 차트를 조회할 수 있다.



## 상품 별 주문 대비 문의 비율 카드
- 관리자는 상품별 (문의 수/주문 수) 비율을 확인할 수 있다.
- 관리자는 정렬 옵션(문의 많은 순/적은 순 및 필요 시 비율 기준)에 따라 카드를 정렬할 수 있다.
- 관리자는 인사이트 보기 토글 상태(전체/인사이트 데이터)에 따라 동일 카드를 조회할 수 있다.

## 언어별 문의 유형 분포 카드
- 관리자는 언어별 카드에서 해당 언어 내 문의 유형 Top N과 비율(%)을 확인할 수 있다.
- 관리자는 정렬 옵션(문의 많은 순/적은 순 또는 비율 기준)에 따라 항목 순서를 조정할 수 있다.
- 관리자는 인사이트 보기 토글 상태(전체/인사이트 데이터)에 따라 동일 카드를 조회할 수 있다.

## 전역 요소
- 인사이트 보기 토글
  - 관리자는 인사이트 보기 토글을 통해 전체 데이터/인사이트 데이터로 모든 차트와 카드를 전환할 수 있다.
  - 토글 상태는 로컬 스토리지에 저장되어 재방문 시에도 유지된다.
- 전역 필터(상단 툴바)
  - 관리자는 기간(시작/종료)을 입력해 전역 기간 필터를 적용할 수 있다.
  - 관리자는 '상품명 또는 코드'로 전역 검색을 적용할 수 있다.
- 전역 필터가 연결된 경우, 모든 차트/카드/테이블에 공통으로 반영된다.

# 요구사항

## 프론트엔드
- 전역 요소(공통)
  - 인사이트 보기 토글: 토글이 켜져있을 때 문의 데이터베이스의 '인사이트 여부' 값이 TRUE인 데이터만 차트에 노출
  - 전역 필터(기간/검색): 모든 차트·카드·테이블 집계에 일관 적용
  - 활성 필터 배지: 대카테고리/세부 카테고리 선택 시 상단 배지로 상태 노출 및 X 버튼으로 해제

- 일자 별 문의 수 차트
  - UI: 단위 탭(일/주/월/분기/반기/연), 메타 정보(기간, 총합, 직전 기간 대비 증감), 호버 툴팁
  - 동작: 단위 전환/인사이트 토글/전역 필터 변경 시 재집계 및 재렌더
  - 필요 데이터(프런트):
    - 시계열: `[ { date: 'YYYY-MM-DD', count: number } ]` (프런트에서 단위 버킷 변환)
    - 총합/기간: `totalInquiries`, `minDate`, `maxDate`
    - (선택) 사전 버킷 집계: 일/주/월/분기/반기/연 별 시리즈

- 최근 문의 표
  - UI: 검색 입력, 정렬(최신순/오래된순), 페이지네이션(10행/페이지), 링크 컬럼(요청 ID/예약코드)
  - 동작: 필터/정렬/검색/페이지 전환 시 클라이언트 재렌더
  - 링크: 요청 ID → 젠데스크 문의 상세, 예약코드 → 어드민 예약 상세로 이동(새 탭)
  - 필요 데이터(프런트) — 행 스키마:
    - `id`, `createdAt`, `productCode`, `productName`, `lang`, `type`, `summary`, `resvCode`
    - (선택) 링크 템플릿: `zendeskTicketBaseUrl`, `adminReservationBaseUrl`

- 대카테고리별 세부 카테고리 파이차트(여행/쇼핑/어학당)
  - UI: 3개의 파이차트, 범례 동시 제공, 세그먼트/범례 클릭 가능 커서
  - 동작: 세그먼트/범례 클릭 시 하단 상품 차트에 교차 필터(대/세부 카테고리) 적용 및 배지 갱신
  - 인사이트 토글 시 FULL/INSIGHT 두 세트를 CSS로 전환
  - 필요 데이터(프런트):
    - 분포 맵: `{ [bigCategory: string]: { [subCategory: string]: number } }`
    - 표시 대상 대카테고리 목록: `['여행','쇼핑','어학당']`

- 상품 기반 분석 차트(막대: 상품명 Y축, 건수 X축)
  - UI: 내부 탭(문의 유형/언어), 정렬(많은 순/적은 순), 주문량 보기 토글, 상품 라벨 클릭 툴팁
  - 동작: 
    - 문의 유형 모드: 언어 필터 탭(영어/일본어/대만어/홍콩어) 적용
    - 언어 모드: 문의 유형 필터 탭 적용
    - 주문량 보기: 언어 모드에서는 언어 분포 비율로 주문 스택 분해, 문의 유형 모드에서는 회색 단일 바
    - 상품 툴팁: 단위 탭과 문의/주문 시계열(그룹형 막대) 제공, 외부 클릭으로 닫힘
  - 총 건수: 현재 적용된 모든 필터를 반영해 상단 설명의 총합을 즉시 갱신
  - 필요 데이터(프런트):
    - `productOrder: string[]`
    - `tri: { [product]: { [type]: { [lang]: number } } }`
    - `types: string[]`, `langs: string[]`, `codeNameMap: { [product]: string }`
    - `orderCounts: { [product]: number }`
    - 툴팁 시계열: `perProductDateCounts`, `perProductOrderDateCounts`

- 상품 별 주문 대비 문의 비율 카드
  - UI: 상품명·비율(%)·문의/주문 값 표시, 정렬(문의/비율 기준) 옵션
  - 동작: 인사이트 토글/전역 필터 반영해 재계산
  - 필요 데이터(프런트): `inquiryTotalsByProduct`, `orderTotalsByProduct`

- 언어별 문의 유형 분포 카드
  - UI: 언어 카드별 Top N 유형과 비율(%), 정렬 옵션
  - 동작: 인사이트 토글/전역 필터 반영해 재계산
  - 필요 데이터(프런트): `langTypeObj[lang][type] = count`

## 백엔드
- 데이터 소스/스키마
  - user_inquiry (user_inquiry_dummy_database.csv)
    - 상품 코드: id=41989966629273인 custom_fields의 값에서 마지막 5자리 수 추출 또는 유저가 입력한 spot 코드
    - 상품 명: id=41989966629273인 custom_fields의 스팟 코드로 spot_translation에서 language='ko'인 spot_name 매핑
    - 언어: id=41989966629273인 custom_fields의 locale (예: zh-TW)
    - 카테고리: id=41988850452761인 custom_fields
    - 문의 유형: id=41988618714009인 custom_fields
    - 문의 내용: ticket_summary
    - 요청 ID: id
    - 예약코드: id=41989351980441인 custom_fields
    - 예약 상태: 실제 개발 시 활용하지 않음
    - createdAt: created_at
    - 대/세부 카테고리 파생: custom_values 중 id=41988850452761의 value를 '_' 기준으로 파싱하여 저장 (대카테고리, 세부 카테고리)
    - 인사이트 여부: 데이터베이스에 추가 필요
  - product_order (product_order_dummy_database.csv)
    - 주문 ID: reserve.code
    - 상품 코드: id=41989966629273인 custom_fields의 값에서 마지막 5자리 수 추출
    - 상품 명: id=41989966629273인 custom_fields의 스팟 코드로 spot_translation에서 language='ko'인 spot_name 매핑
    - 주문 일시: reserve.created_at
    - 수량: reserve.order_number
    - (주문 상태/결제 수단/주문 금액: 미사용 → 수집/전송 제외)

- 집계 요구(차트별)
  - 일자 별 문의 수: created_at 기반 일/주/월/분기/반기/연 단위 버킷 집계(필터·인사이트 반영)
  - 파이(대/세부): big_category → sub_category 분포 집계(여행/쇼핑/어학당 각각)
  - 상품 기반 분석: product_code × (type|lang) 교차집계, 총합 및 상품별 순서 산출
  - 주문 시계열/보조막대: product_order의 날짜 절삭 집계 및 상품별 총 주문량, 언어 분해는 문의 비율로 추정
  - 카드 집계: 
    - 주문 대비 문의 비율 = Σ(문의 수) / Σ(주문 수량)
    - 언어별 문의 유형 분포 = lang별 {type→count} 및 Top N
  - 응답 데이터(권장 스키마 예시)
    - 공통 메타: `date_from`, `date_to`, `product_search`, `insight_only`
    - 트렌드: `series: Array<{ date: 'YYYY-MM-DD', count: number }>`
    - 테이블: `rows: Array<{ id, createdAt, productCode, productName, lang, type, summary, resvCode }>`
    - 파이(대/세부): `bigDetail: { [big]: { [sub]: number } }`
    - 상품 차트: `productOrder`, `tri`, `types`, `langs`, `codeNameMap`, `orderCounts`, `perProductDateCounts`, `perProductOrderDateCounts`
    - 비율 카드: `inquiryTotalsByProduct`, `orderTotalsByProduct`
    - 언어×유형 카드: `langType: { [lang]: { [type]: number } }`

- 제공 방식/엔드포인트(선택)
  - 정적 생성(JSON/CSV) 또는 REST API
  - 공통 쿼리 파라미터: date_from, date_to, product_search, insight_only(Boolean)
  - 응답 성능: 캐싱(단위/기간/필터 키로 캐시), 페이지네이션(최근 문의 표), 스트리밍/압축 고려
